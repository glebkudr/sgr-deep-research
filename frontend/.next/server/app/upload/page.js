(()=>{var e={};e.id=676,e.ids=[676],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},37653:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),t(95219),t(11506),t(35866);var a=t(23191),n=t(88716),r=t(37922),l=t.n(r),i=t(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);t.d(s,o);let d=["",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,95219)),"E:\\Code\\1C\\sgr-deep-research\\frontend\\app\\upload\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,11506)),"E:\\Code\\1C\\sgr-deep-research\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\Code\\1C\\sgr-deep-research\\frontend\\app\\upload\\page.tsx"],u="/upload/page",p={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/upload/page",pathname:"/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},33854:(e,s,t)=>{Promise.resolve().then(t.bind(t,81026))},91986:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},19693:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,79404,23))},81026:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(10326),n=t(17577),r=t(3679),l=t(84231);function i({value:e,label:s}){let t="number"==typeof e?Math.min(100,Math.max(0,e)):null;return(0,a.jsxs)("div",{className:"progress",children:[s&&a.jsx("span",{className:"progress-label",children:s}),a.jsx("div",{className:"progress-track",children:a.jsx("div",{className:"progress-fill",style:{width:null!==t?`${t}%`:"100%"},"aria-hidden":"true"})})]})}var o=t(9007),d=t(78998),c=t(6824);function u(){let[e,s]=(0,n.useState)(""),[t,u]=(0,n.useState)([]),[x,m]=(0,n.useState)(null),[j,f]=(0,n.useState)(null),[g,v]=(0,n.useState)(!1),[b,y]=(0,n.useState)(null),[N,C]=(0,n.useState)(null),[P,_]=(0,n.useState)([]),k=t.length,S=(0,n.useRef)(null),w=(0,n.useMemo)(()=>new Set(["bsl","xml","html","htm","txt"]),[]);(0,n.useCallback)(e=>{let s={jobId:e.job_id,collection:e.collection,status:e.status,updatedAt:new Date().toISOString()};_(e=>[s,...e.filter(e=>e.jobId!==s.jobId)].slice(0,5))},[]);let I=async()=>{if(y(null),C(null),!e.trim()){y("Укажите коллекцию.");return}if(!t.length){y("Выберите хотя бы один файл.");return}let s=new FormData;s.append("collection",e.trim()),t.forEach(e=>{let t=e.webkitRelativePath||e.name;s.append("files",e,t)}),v(!0);let a=await (0,c.N)({path:"/upload",method:"POST",body:s});if(v(!1),!a.ok||!a.data){C({message:a.error??"Не удалось создать задачу.",variant:"error"});return}m(null),f(a.data.job_id),C({message:"Задача создана, начато индексирование.",variant:"success"})},E=async e=>{let t=await (0,c.N)({path:`/jobs/${e}`});t.ok&&t.data&&(f(e),m(t.data),s(t.data.collection),C({message:"Загружен статус задачи.",variant:"info"}))},A=e=>{let s=(e||"").trim();if(!s){C({message:"Нет имени коллекции для просмотра в графе.",variant:"error"});return}let t=`/graphview?collection=${encodeURIComponent(s)}`;window.open(t,"_blank","noopener,noreferrer")},$=(0,n.useMemo)(()=>x&&0!==k?Math.min(100,Math.round(x.stats.processed_files/k*100)):null,[x,k]);return(0,a.jsxs)("div",{className:"stack",children:[N&&a.jsx(d.F,{message:N.message,variant:N.variant,onClose:()=>C(null)}),(0,a.jsxs)("section",{className:"panel stack",children:[a.jsx("h2",{children:"Загрузка выгрузки 1С"}),a.jsx("p",{className:"text-muted",children:"Файлы будут сохранены в workspace и поставлены в очередь на обработку индексатором Neo4j/FAISS."}),a.jsx(l.I,{label:"Коллекция",value:e,onChange:e=>s(e.target.value)}),(0,a.jsxs)("label",{className:"field",children:[a.jsx("span",{className:"field-label",children:"Файлы (.bsl, .xml, .html, .txt)"}),(0,a.jsxs)("div",{className:"dropzone",children:[a.jsx("input",{ref:S,type:"file",multiple:!0,onChange:e=>{y(null);let s=Array.from(e.target.files??[]),t=s.filter(e=>{let s=(e.webkitRelativePath||e.name).toLowerCase().split(".").pop()??"";return w.has(s)});t.length!==s.length&&C({message:"Некоторые файлы были отклонены: поддерживаются .bsl, .xml, .html, .txt.",variant:"error"}),u(t)},style:{display:"none"},id:"file_input",accept:".bsl,.xml,.html,.htm,.txt"}),a.jsx("p",{children:"Перетащите файлы или нажмите, чтобы выбрать."}),a.jsx(r.z,{variant:"secondary",onClick:()=>document.getElementById("file_input")?.click(),children:"Выбрать файлы"})]})]}),t.length>0&&(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("h3",{children:["Выбрано файлов: ",t.length]}),a.jsx("ul",{className:"file-list",children:t.map(e=>(0,a.jsxs)("li",{children:[a.jsx("span",{children:e.name}),(0,a.jsxs)("span",{children:[(e.size/1024).toFixed(1)," KB"]})]},e.name))})]}),b&&a.jsx("div",{className:"card status-error",children:b}),a.jsx(r.z,{onClick:I,loading:g,disabled:g,children:"Запустить индексирование"})]}),j&&(0,a.jsxs)("section",{className:"panel stack",children:[(0,a.jsxs)("header",{className:"inline",style:{justifyContent:"space-between"},children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{children:"Статус задачи"}),(0,a.jsxs)("p",{className:"text-muted",children:["Job ID: ",a.jsx("code",{children:j})]})]}),a.jsx(p,{status:x?.status??"PENDING"})]}),null!==$&&a.jsx(i,{value:$,label:"Обработка файлов"}),(0,a.jsxs)("div",{className:"card-grid",children:[a.jsx(h,{title:"Файлы",value:x?.stats.processed_files??0}),a.jsx(h,{title:"Граф: узлы",value:x?.stats.nodes??0}),a.jsx(h,{title:"Граф: связи",value:x?.stats.edges??0}),a.jsx(h,{title:"FAISS чанк",value:x?.stats.vector_chunks??0}),a.jsx(h,{title:"Длительность (сек)",value:(x?.stats.duration_sec??0).toFixed(1)})]}),x?.errors.length?(0,a.jsxs)("div",{className:"card stack",children:[a.jsx("h3",{children:"Ошибки"}),a.jsx("ul",{className:"file-list",children:x.errors.map((e,s)=>(0,a.jsxs)("li",{children:[a.jsx("span",{children:e.message}),e.path&&a.jsx("span",{children:e.path})]},`${e.message}-${s}`))})]}):x&&"RUNNING"===x.status?(0,a.jsxs)("div",{className:"inline",style:{alignItems:"center"},children:[a.jsx(o.$,{}),a.jsx("span",{children:"Идет индексирование…"})]}):null]}),(0,a.jsxs)("section",{className:"panel stack",children:[(0,a.jsxs)("header",{className:"inline",style:{justifyContent:"space-between"},children:[a.jsx("h2",{children:"Недавние задачи"}),a.jsx(r.z,{variant:"secondary",onClick:()=>_([]),children:"Очистить список"})]}),0===P.length?a.jsx("p",{className:"text-muted",children:"Пока нет сохраненных задач."}):a.jsx("ul",{className:"file-list",children:P.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:e.collection}),a.jsx("div",{className:"text-muted",children:new Date(e.updatedAt).toISOString().replace("T"," ").slice(0,19)})]}),(0,a.jsxs)("div",{className:"inline",style:{alignItems:"center",gap:"0.5rem"},children:[a.jsx(p,{status:e.status}),a.jsx(r.z,{variant:"secondary",onClick:()=>A(e.collection),children:"Открыть"}),a.jsx(r.z,{variant:"secondary",onClick:()=>E(e.jobId),children:"Статус"})]})]},e.jobId))})]})]})}function p({status:e}){return a.jsx("span",{className:`status-pill status-${e.toLowerCase()}`,children:{PENDING:"Ожидает",RUNNING:"Идет",DONE:"Готово",ERROR:"Ошибка"}[e]})}function h({title:e,value:s}){return(0,a.jsxs)("div",{className:"card",children:[a.jsx("h4",{style:{margin:"0 0 0.25rem"},children:e}),a.jsx("strong",{style:{fontSize:"1.3rem"},children:s})]})}},3679:(e,s,t)=>{"use strict";t.d(s,{z:()=>l});var a=t(10326),n=t(48029),r=t.n(n);function l({className:e,variant:s="primary",loading:t,children:n,...l}){return a.jsx("button",{className:r()("btn",{"btn-primary":"primary"===s,"btn-secondary":"secondary"===s,"btn-loading":t},e),disabled:t||l.disabled,...l,children:n})}},84231:(e,s,t)=>{"use strict";t.d(s,{I:()=>l});var a=t(10326),n=t(48029),r=t.n(n);function l({label:e,error:s,className:t,...n}){return(0,a.jsxs)("label",{className:"field",children:[e&&a.jsx("span",{className:"field-label",children:e}),a.jsx("input",{className:r()("field-input",t,{"field-error":!!s}),...n}),s&&a.jsx("span",{className:"field-hint",children:s})]})}},9007:(e,s,t)=>{"use strict";t.d(s,{$:()=>n});var a=t(10326);function n(){return a.jsx("span",{className:"spinner","aria-hidden":"true"})}},78998:(e,s,t)=>{"use strict";t.d(s,{F:()=>l});var a=t(10326),n=t(48029),r=t.n(n);function l({message:e,variant:s="info",onClose:t}){return(0,a.jsxs)("div",{className:r()("toast",`toast-${s}`),children:[a.jsx("span",{children:e}),t&&a.jsx("button",{className:"toast-close",onClick:t,"aria-label":"Close notification",children:"\xd7"})]})}},6824:(e,s,t)=>{"use strict";t.d(s,{N:()=>r});let a=process.env.NEXT_PUBLIC_API_URL??"http://localhost:8000",n=process.env.NEXT_PUBLIC_JWT;async function r(e){let s;let t=`${a}${e.path}`,r={...e.headers??{}};n&&(r.Authorization=`Bearer ${n}`),e.body instanceof FormData?s=e.body:void 0!==e.body&&(r["Content-Type"]="application/json",s=JSON.stringify(e.body));let l=await fetch(t,{method:e.method??"GET",headers:r,body:s}),i=l.headers.get("content-type")?.includes("application/json")?await l.json():await l.text();return l.ok?{ok:!0,status:l.status,data:i}:{ok:!1,status:l.status,error:"string"==typeof i?i:i?.detail??"Request failed"}}},11506:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(19510),n=t(57371);function r({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{children:(0,a.jsxs)("div",{className:"app-shell",children:[(0,a.jsxs)("header",{className:"app-header",children:[a.jsx("h1",{children:"GraphRAG 1C Console"}),(0,a.jsxs)("nav",{children:[a.jsx(n.default,{href:"/upload",children:"Upload & Index"}),a.jsx(n.default,{href:"/qa",children:"Q&A"})]})]}),a.jsx("main",{className:"app-main",children:e})]})})})}t(7633)},95219:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>i});var a=t(68570);let n=(0,a.createProxy)(String.raw`E:\Code\1C\sgr-deep-research\frontend\app\upload\page.tsx`),{__esModule:r,$$typeof:l}=n;n.default;let i=(0,a.createProxy)(String.raw`E:\Code\1C\sgr-deep-research\frontend\app\upload\page.tsx#default`)},7633:()=>{},48029:(e,s)=>{var t;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var a={}.hasOwnProperty;function n(){for(var e="",s=0;s<arguments.length;s++){var t=arguments[s];t&&(e=r(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var s="";for(var t in e)a.call(e,t)&&e[t]&&(s=r(s,t));return s}(t)))}return e}function r(e,s){return s?e?e+" "+s:e+s:e}e.exports?(n.default=n,e.exports=n):void 0!==(t=(function(){return n}).apply(s,[]))&&(e.exports=t)}()}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[948,707],()=>t(37653));module.exports=a})();